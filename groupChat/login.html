<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0,user-scalable=no">
    <title>login</title>
    <link rel="stylesheet" href="css/index.css">
</head>
<body>
    <div class="login">
        <div class="ulayer">
            <div class="name">账号</div>
            <input type="text" placeholder="输入账号" id="name">
        </div>
        <div class="ulayer">
            <div class="name">密码</div>
            <input type="password" placeholder="输入账号" id="password">
        </div>
        <div class="landing">登陆</div>
        <div class="note">
            <div class="name">NOTE:</div>
            <p>测试群聊和单聊的通讯功能（文字互发）；</p>
            <p>不存储通讯记录；</p>
        </div>
        <div class="loading_">
            <div class="loading_ani">
                <div><span></span></div>
                <div><span></span></div>
                <div><span></span></div>
            </div>
        </div>

    </div>
    <script src="js/jquery.3.3.1.js"></script>
    <script src="js/index.js"></script>
    <script>

        $(".landing").click(function(){
            var _this=$(this);
            if(!_this.hasClass("logining")){

                var name=$("#name").val();
                if(name.match(/^\s*$/)){
                    alert('姓名不能为空');
                    return false;
                }
                var password=$("#password").val();
                if(password.match(/^\s*$/)){
                    alert('密码不能为空');
                    return false;
                }

                $(".loading_").show();
                _this.html('登陆中......').addClass("logining");

                var lsJson={
                    phone:name,
                    password:password,
                    class:2,
                    loginType:'webType'
                }

                $.ajax({
                    type:'post',
                    url:'http://ydjkf.hydee.cn/merchants/user/login',
                    data:lsJson,
                    dataType:'json',
                    success:function(data) {
                        $(".loadingLogin").hide();
                        if(data.success){
                            var dataz=data.data;
                            var lsJsonE=dataz.employeeMap;

                            var lsJson={
                                id:lsJsonE.userid,
                                name:lsJsonE.trueName,
                                img:lsJsonE.headPictures,
                                token:dataz.token,
                                mercode:lsJsonE.merchantCode,
                            }

                            sessionStorage.setItem("lsGroupChat",JSON.stringify(lsJson));

                            langingerror(_this);
                            location.href=`chatinglist.html`

                        }else{
                            langingerror(_this);

                            if(data.msg) alert(data.msg);
                            else alert('登陆失败');
                        }
                    },
                    error:function(){
                        langingerror(_this);
                        alert("网络错误，请重试");
                    }
                })


            }
        })

        function langingerror(obj){
            $(".loading_").hide();
            obj.html('登陆').removeClass("logining");
        }
    </script>
</body>
</html>